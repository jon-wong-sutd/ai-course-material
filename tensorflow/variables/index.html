<!DOCTYPE html>
<html lang="en">

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Variables</title>
  <meta name="description" content="Artificial intelligence (AI) is a rich field spanning formal systems for representing and processing symbolic information, computational models of human cogn...">

  <link rel="stylesheet" href="/ai-course-material/assets/main.css">
  <link rel="canonical" href="/ai-course-material/tensorflow/variables/">
  <link rel="alternate" type="application/rss+xml" title="50.021 Artificial Intelligence" href="/ai-course-material/feed.xml">
  
  
</head>


  <body>

    <header class="site-header" role="banner">

  <div class="wrapper">
    
    
    <a class="site-title" href="/ai-course-material/">50.021 Artificial Intelligence</a>
  
    
      <nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path fill="#424242" d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.031C17.335,0,18,0.665,18,1.484L18,1.484z"/>
              <path fill="#424242" d="M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0c0-0.82,0.665-1.484,1.484-1.484 h15.031C17.335,6.031,18,6.696,18,7.516L18,7.516z"/>
              <path fill="#424242" d="M18,13.516C18,14.335,17.335,15,16.516,15H1.484C0.665,15,0,14.335,0,13.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.031C17.335,12.031,18,12.696,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger">
          
            
            
            <a class="page-link" href="/ai-course-material/tensorflow/">Tensorflow</a>
            
          
            
            
            <a class="page-link" href="/ai-course-material/about/">About</a>
            
          
        </div>
      </nav>
    
  </div>
</header>


    <main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post">

  <header class="post-header">
    <h1 class="post-title">Variables</h1>
  </header>

  <div class="post-content">
    <ul id="markdown-toc">
  <li><a href="#overview" id="markdown-toc-overview">Overview</a></li>
  <li><a href="#placeholder" id="markdown-toc-placeholder">Placeholder</a></li>
  <li><a href="#variables" id="markdown-toc-variables">Variables</a></li>
  <li><a href="#variable_scope" id="markdown-toc-variable_scope">variable_scope</a></li>
  <li><a href="#placeholders-as-parameters" id="markdown-toc-placeholders-as-parameters">Placeholders as Parameters</a></li>
  <li><a href="#variables-as-parameters" id="markdown-toc-variables-as-parameters">Variables as Parameters</a></li>
  <li><a href="#variables-as-checkpoints" id="markdown-toc-variables-as-checkpoints">Variables as Checkpoints</a></li>
  <li><a href="#exercises" id="markdown-toc-exercises">Exercises</a></li>
</ul>

<h1 id="overview">Overview</h1>

<p>The goal of this lesson is to explain some common elements that you will see in tensorflow codes … and why they are used.</p>

<ul>
  <li>
    <p>placeholder</p>
  </li>
  <li>
    <p>Variable</p>
  </li>
  <li>
    <p>variable_scope, name_scope – for encapsulation. (See <a href="https://www.tensorflow.org/api_docs/python/tf/variable_scope">official doc for variable_scope</a> and for <a href="https://www.tensorflow.org/api_docs/python/tf/Graph\#name_scope">name_scope</a></p>
  </li>
</ul>

<p>We have seen in <a href="/ai-course-material/tensorflow/tensor-vs-node">Tensors and Operators</a>, an <em>operator</em> takes <em>tensor</em>s as inputs, and produces an output <em>tensor</em>. A tensor is just a unit of data. It can have a datatype, a rank ( the number of dimensions, 0 for a scalar, 1 for a vector, 2 for a matrix, <em>n</em> for higher order tensors), and a shape.</p>

<p>In terms of the graph: the operators are the nodes, and tensors are the edges.</p>

<p>The philosophy is: you create a graph in python, then you create a session, initialize all <s>global</s> variables to be used, and do a <code class="highlighter-rouge">sess.run([op1,op2], feed_dict=fd)</code>. The latter runs the graph. When you run the graph, there is a compilation step, and the actual computation is run in <em>C++</em>.</p>

<h1 id="placeholder">Placeholder</h1>

<p>A place holder is a tensor, with one special property: if you do not feed it with a feed dictionary, you will get an error message. You can feed values not only into placeholders, but only placeholders will generate an error if unfed. Thus they are a good choice for feeding in data into the graph.</p>

<p>This example highlights why you should use placeholders:</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">import</span> <span class="nn">tensorflow</span> <span class="kn">as</span> <span class="nn">tf</span>

<span class="k">def</span> <span class="nf">somefunction</span><span class="p">(</span><span class="n">x1</span><span class="p">):</span>
  
  <span class="n">res</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span><span class="n">tf</span><span class="o">.</span><span class="n">constant</span><span class="p">(</span><span class="mf">5.</span><span class="p">))</span>

  <span class="k">return</span> <span class="n">res</span>


<span class="k">def</span> <span class="nf">run1</span><span class="p">():</span>
  <span class="n">sess</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">Session</span><span class="p">()</span>

  <span class="n">x1</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">placeholder</span><span class="p">(</span><span class="s">"float"</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
  
  <span class="n">res</span><span class="o">=</span><span class="n">somefunction</span><span class="p">(</span><span class="n">x1</span><span class="p">)</span>


  <span class="n">init</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">global_variables_initializer</span><span class="p">()</span> 
  <span class="n">sess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">init</span><span class="p">)</span> <span class="c">#run variable initializer!!!!</span>

  <span class="n">value</span><span class="o">=</span><span class="n">sess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">res</span><span class="p">,</span><span class="n">feed_dict</span><span class="o">=</span><span class="p">{</span><span class="n">x1</span><span class="p">:</span><span class="mf">2.</span><span class="p">})</span>
  <span class="k">print</span> <span class="p">(</span><span class="s">'  '</span><span class="p">)</span>
  <span class="k">print</span> <span class="p">(</span><span class="s">'value of a placeholder, and value 2 fed in by a feed dict'</span><span class="p">,</span><span class="n">value</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">run2</span><span class="p">():</span>
  <span class="n">sess</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">Session</span><span class="p">()</span>

  <span class="n">x1</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">constant</span><span class="p">(</span><span class="o">-</span><span class="mf">5.0</span><span class="p">,</span><span class="s">"float"</span><span class="p">)</span>
  
  <span class="n">res</span><span class="o">=</span><span class="n">somefunction</span><span class="p">(</span><span class="n">x1</span><span class="p">)</span>


  <span class="n">init</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">global_variables_initializer</span><span class="p">()</span> 
  <span class="n">sess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">init</span><span class="p">)</span> <span class="c">#run variable initializer!!!!</span>

  <span class="n">value</span><span class="o">=</span><span class="n">sess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">res</span><span class="p">,</span><span class="n">feed_dict</span><span class="o">=</span><span class="p">{</span><span class="n">x1</span><span class="p">:</span><span class="mf">2.</span><span class="p">})</span>
  <span class="k">print</span> <span class="p">(</span><span class="s">'  '</span><span class="p">)</span>
  <span class="k">print</span> <span class="p">(</span><span class="s">'value of a tensor, and value 2 fed in by a feed dict'</span><span class="p">,</span><span class="n">value</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">run3</span><span class="p">():</span>
  <span class="n">sess</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">Session</span><span class="p">()</span>

  <span class="n">x1</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">constant</span><span class="p">(</span><span class="o">-</span><span class="mf">5.0</span><span class="p">,</span><span class="s">"float"</span><span class="p">)</span>
  
  <span class="n">res</span><span class="o">=</span><span class="n">somefunction</span><span class="p">(</span><span class="n">x1</span><span class="p">)</span>


  <span class="n">init</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">global_variables_initializer</span><span class="p">()</span> 
  <span class="n">sess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">init</span><span class="p">)</span> <span class="c">#run variable initializer!!!!</span>

  <span class="n">value</span><span class="o">=</span><span class="n">sess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>
  <span class="k">print</span> <span class="p">(</span><span class="s">'  '</span><span class="p">)</span>
  <span class="k">print</span> <span class="p">(</span><span class="s">'value of a tensor, where we forget to feed in the value 2 via feed dict'</span><span class="p">,</span><span class="n">value</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">run5</span><span class="p">():</span>
  <span class="n">sess</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">Session</span><span class="p">()</span>

  <span class="n">x1</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">placeholder</span><span class="p">(</span><span class="s">"float"</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
  
  <span class="n">res</span><span class="o">=</span><span class="n">somefunction</span><span class="p">(</span><span class="n">x1</span><span class="p">)</span>


  <span class="n">init</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">global_variables_initializer</span><span class="p">()</span> 
  <span class="n">sess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">init</span><span class="p">)</span> <span class="c">#run variable initializer!!!!</span>

  <span class="k">print</span> <span class="p">(</span><span class="s">'  '</span><span class="p">)</span>
  <span class="k">print</span><span class="p">(</span><span class="s">'result with a placeholder where we forget to feed in the value via feed dict'</span> <span class="p">)</span>

  <span class="n">value</span><span class="o">=</span><span class="n">sess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">res</span><span class="p">)</span> <span class="c">#gives an error: uninitialized place holder</span>
  <span class="k">print</span> <span class="p">(</span><span class="s">'error'</span><span class="p">,</span><span class="n">value</span><span class="p">)</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">"__main__"</span><span class="p">:</span>
  <span class="n">run1</span><span class="p">()</span>
  <span class="n">run2</span><span class="p">()</span>
  <span class="n">run3</span><span class="p">()</span>
  <span class="n">run5</span><span class="p">()</span></code></pre></figure>

<h1 id="variables">Variables</h1>

<p>A variable is a tensor with two special properties:</p>

<ul>
  <li>its value is saved when one write a checkpoint using <code class="highlighter-rouge">tf.train.Saver</code></li>
  <li>it is a mutable tensor</li>
</ul>

<p>We explain both.</p>

<p><strong>Saving values:</strong> when training a neural network, we have to compute activations of layers, gradients and updates of weights. When we want to use a trained neural network, then we need to save and load the weights. So one needs to save the weights during training. Variables are those tensors, for which the current values are stored when writing a checkpoint using <code class="highlighter-rouge">tf.train.Saver</code>. Thats why variables are used in tensorflow to store weights and other kind of trainable/learnable parameters of a network. This is their main usage in tensorflow.</p>

<p><strong>Mutable tensor:</strong> you can define a variable <code class="highlighter-rouge">v</code>, and use <code class="highlighter-rouge">v.assign(val)</code> inside a graph, or <code class="highlighter-rouge">sess.run(v.assign(val))</code> within python to assign  value <em>val</em> to a variable. The ability to assign a value by <em>tf.assign</em> is not the formal definition of mutability, but its most practical consequence.</p>

<p>Variables can be simply <s>put</s> brought into existence by <code class="highlighter-rouge">v=tf.get_variable(...)</code> without depending on anything in the graph, and they can be assigned some value. All other tensors except placeholders are the result of some graph computation.
For that reason variables are often used for step counters and other data that can change during training.</p>

<ul>
  <li>
    <p>note 1: some tensorflow operations require a mutable tensor - that is usually a variable.</p>
  </li>
  <li>
    <p>note 2: you can use variables with feed dicts, but they will not complain if you forget to feed them.</p>
  </li>
  <li>
    <p>note 3: if using <code class="highlighter-rouge">v=tf.get_variable(name='v', ...)</code> to create a variable, then it comes with a safeguard (that can be disabled by <code class="highlighter-rouge">reuse_variable()</code>) against accessing the same variable twice by two calls of <code class="highlighter-rouge">v=tf.get_variable(name='v',...)</code> that refer to the same <code class="highlighter-rouge">name</code>. For that reason <code class="highlighter-rouge">v=tf.get_variable(name='v', ...)</code> should be preferred over <code class="highlighter-rouge">v=tf.Variable(...)</code></p>
  </li>
</ul>

<p><code class="highlighter-rouge">variable_scope('scopename')</code> (see lesson) is a way to encapsulate variables with the same name. <code class="highlighter-rouge">variable_scope('scopename')</code> allows to reuse a function that creates a tensor flow operation and during that creation also creates a variable with a fixed name – which without this scope would cause an error due to above safeguard.</p>

<p>Note: <code class="highlighter-rouge">name_scope('scopename')</code> does NOT work with <code class="highlighter-rouge">v=tf.get\_variable(...)</code>, but only with <code class="highlighter-rouge">tf.Variable</code>. in terms of style it is encouraged to use <code class="highlighter-rouge">v=tf.get\_variable(...)</code></p>

<p>An example of variables checkpointing:</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">import</span> <span class="nn">tensorflow</span> <span class="kn">as</span> <span class="nn">tf</span>

<span class="k">def</span> <span class="nf">returnsometensor</span><span class="p">(</span><span class="n">x1</span><span class="p">):</span>
 
  <span class="n">res</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span><span class="n">tf</span><span class="o">.</span><span class="n">constant</span><span class="p">(</span><span class="mf">5.</span><span class="p">))</span>

  <span class="k">return</span> <span class="n">res</span>


<span class="k">def</span> <span class="nf">run</span><span class="p">():</span>
  <span class="n">sess</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">Session</span><span class="p">()</span>

  <span class="n">x1</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">constant</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span><span class="n">dtype</span><span class="o">=</span><span class="s">"float"</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="bp">None</span><span class="p">)</span>

  
  <span class="n">res</span><span class="o">=</span><span class="n">returnsometensor</span><span class="p">(</span><span class="n">x1</span><span class="p">)</span>

  <span class="n">somevariable</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">get_variable</span><span class="p">(</span><span class="s">'somevariable'</span><span class="p">,</span> <span class="p">[],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span> <span class="c"># [] - a scalar</span>

  <span class="n">init</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">global_variables_initializer</span><span class="p">()</span> 
  <span class="n">saver</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">train</span><span class="o">.</span><span class="n">Saver</span><span class="p">()</span>

  <span class="n">sess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">init</span><span class="p">)</span> <span class="c">#run variable initializer!!!!</span>

  <span class="c">#compute the value of res tensor</span>
  <span class="n">value</span><span class="o">=</span><span class="n">sess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">res</span><span class="p">,</span><span class="n">feed_dict</span><span class="o">=</span><span class="p">{</span><span class="n">x1</span><span class="p">:</span><span class="mf">3.</span><span class="p">})</span>
  <span class="c"># assign the value of res to somevariable</span>
  <span class="n">sess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">somevariable</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="n">value</span><span class="p">))</span>



  <span class="n">currentvalues</span><span class="o">=</span><span class="n">sess</span><span class="o">.</span><span class="n">run</span><span class="p">([</span><span class="n">somevariable</span><span class="p">])</span>
  <span class="k">print</span><span class="p">(</span><span class="s">' '</span><span class="p">)</span>
  <span class="k">print</span><span class="p">(</span><span class="s">' '</span><span class="p">)</span>
  <span class="k">print</span> <span class="p">(</span><span class="s">'original value of somevariable'</span><span class="p">,</span><span class="n">currentvalues</span><span class="p">)</span>
 
  <span class="c"># one saves a session! not variables</span>
  <span class="n">saver</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">sess</span><span class="p">,</span> <span class="s">'./checkpoints/tester.ckpt'</span><span class="p">,</span> <span class="n">global_step</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="c">#global_step is a step counter (e.g. train epochs)</span>
  
  <span class="c"># recompute result, reassign to variable</span>
  <span class="n">value</span><span class="o">=</span><span class="n">sess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">res</span><span class="p">,</span><span class="n">feed_dict</span><span class="o">=</span><span class="p">{</span><span class="n">x1</span><span class="p">:</span><span class="mf">0.</span><span class="p">})</span>
  <span class="n">sess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">somevariable</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="n">value</span><span class="p">))</span>
  
  <span class="n">currentvalues</span><span class="o">=</span><span class="n">sess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">somevariable</span><span class="p">,</span> <span class="n">feed_dict</span><span class="o">=</span><span class="p">{</span><span class="n">x1</span><span class="p">:</span><span class="mf">0.</span><span class="p">})</span>
  <span class="k">print</span> <span class="p">(</span><span class="s">'value of somevariable after new computation'</span><span class="p">,</span> <span class="n">currentvalues</span><span class="p">)</span>

  <span class="c"># reassign the tensor res, when evaluated, it will have value -3 </span>
  <span class="c">#res=tf.constant(-3.0,dtype="float", shape=None)</span>
  <span class="c">#somevariable = tf.constant(-3.0,dtype="float", shape=None) # one way to prevent a variable to be overwritten upon restore is to overwrite it with a non-restorable object, here a standard tensor</span>


 
  <span class="c"># restore - this affects somevariable as long as you did not change it to a tensor like with the command above</span>
  <span class="n">saver</span><span class="o">.</span><span class="n">restore</span><span class="p">(</span><span class="n">sess</span><span class="p">,</span> <span class="n">tf</span><span class="o">.</span><span class="n">train</span><span class="o">.</span><span class="n">latest_checkpoint</span><span class="p">(</span><span class="s">'checkpoints'</span><span class="p">))</span>
  <span class="c"># but restore will not affect tensor res</span>
  
  <span class="k">print</span><span class="p">(</span><span class="s">'value after restore: somevariable'</span><span class="p">,</span><span class="n">sess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">somevariable</span><span class="p">))</span>
  <span class="k">print</span><span class="p">(</span><span class="s">' '</span><span class="p">)</span>

  <span class="k">print</span><span class="p">(</span><span class="s">'value after restore: result tensor (used to feed variable): sess.run(res) '</span><span class="p">,</span> <span class="n">sess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">res</span><span class="p">))</span>
  <span class="k">print</span><span class="p">(</span><span class="s">'NOTE!! result tensor: sess.run(res) RECOMPUTES THE TENSOR! it does NOT simply print it'</span>  <span class="p">)</span>

  <span class="c">#sess.run(res.assign(somevariable)) # you cannot assign a value to a tensor!! this will create an error</span>
  <span class="c"># you can do this ONLY with variables - which are mutable</span>

  <span class="c"># with a variable v: one can define it, then run sess.run(v.assign(xvalue)) so that it gets a value xvalue</span>
  <span class="c"># any later sess.run(v) or any call to v when used in a graph will use the value xvalue</span>
   

  <span class="c"># this also explains why we should use placeholders for feeding in data: </span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">"__main__"</span><span class="p">:</span>
  <span class="n">run</span><span class="p">()</span></code></pre></figure>

<h1 id="variable_scope">variable_scope</h1>

<p>The tensorflow tutorial says wisely:
Variable scope allows to create new variables and to share already created ones while providing checks to not create or share by accident.</p>

<p><a href="https://www.tensorflow.org/programmers_guide/variables">https://www.tensorflow.org/programmers_guide/variables </a></p>

<h1 id="placeholders-as-parameters">Placeholders as Parameters</h1>

<p>As we have seen in <a href="/ai-course-material/tensorflow/feeddict/">lesson on <code class="highlighter-rouge">feed_dict</code></a>, we can pass parameters into a run of a graph via <code class="highlighter-rouge">tf.placeholder</code> and <code class="highlighter-rouge">feed_dict</code>.</p>

<p>To recall how that is done, we create a simple graph that calculates the <em>n</em>th term of the <a href="https://en.wikipedia.org/wiki/Fibonacci_number">Fibonacci sequence</a>. The parameters to pass into each run of the graph are:</p>
<ul>
  <li><em>(n-1)</em>th term</li>
  <li><em>(n-2)</em>th term</li>
</ul>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">import</span> <span class="nn">tensorflow</span> <span class="kn">as</span> <span class="nn">tf</span>

<span class="k">def</span> <span class="nf">build_graph</span><span class="p">():</span>
    <span class="c"># Term n of a fibonacci sequence is the sum of last 2 terms.</span>

    <span class="n">n_1</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">placeholder</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span> <span class="c"># (n-1)th term</span>
    <span class="n">n_2</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">placeholder</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span> <span class="c"># (n-2)th term</span>

    <span class="n">n</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">n_1</span><span class="p">,</span> <span class="n">n_2</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">n_1</span><span class="p">,</span> <span class="n">n_2</span><span class="p">,</span> <span class="n">n</span>

<span class="k">def</span> <span class="nf">run</span><span class="p">():</span>
    <span class="n">sess</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">Session</span><span class="p">()</span>

    <span class="n">n_1</span><span class="p">,</span> <span class="n">n_2</span><span class="p">,</span> <span class="n">n</span> <span class="o">=</span> <span class="n">build_graph</span><span class="p">()</span>

    <span class="c"># First 2 terms are 0 and 1.</span>
    <span class="n">n_2_val</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">n_1_val</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">10</span><span class="p">):</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">sess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">feed_dict</span><span class="o">=</span><span class="p">{</span><span class="n">n_2</span><span class="p">:</span> <span class="n">n_2_val</span><span class="p">,</span> <span class="n">n_1</span><span class="p">:</span> <span class="n">n_1_val</span><span class="p">})</span>
        <span class="k">print</span><span class="p">(</span><span class="s">'Term {} is {}'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">result</span><span class="p">))</span>
        <span class="n">n_2_val</span> <span class="o">=</span> <span class="n">n_1_val</span>
        <span class="n">n_1_val</span> <span class="o">=</span> <span class="n">result</span>

<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="n">run</span><span class="p">()</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">"__main__"</span><span class="p">:</span>
    <span class="n">main</span><span class="p">()</span></code></pre></figure>

<h1 id="variables-as-parameters">Variables as Parameters</h1>

<p>The exact equivalent of the above code, but using variables, is:</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">import</span> <span class="nn">tensorflow</span> <span class="kn">as</span> <span class="nn">tf</span>

<span class="k">def</span> <span class="nf">build_graph</span><span class="p">():</span>
    <span class="c"># Term n of a fibonacci sequence is the sum of last 2 terms.</span>

    <span class="n">n_1</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">get_variable</span><span class="p">(</span><span class="s">'n_1'</span><span class="p">,</span> <span class="p">[],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span> <span class="c"># (n-1)th term</span>
    <span class="n">n_2</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">get_variable</span><span class="p">(</span><span class="s">'n_2'</span><span class="p">,</span> <span class="p">[],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span> <span class="c"># (n-2)th term</span>

    <span class="n">n</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">n_1</span><span class="p">,</span> <span class="n">n_2</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">n_1</span><span class="p">,</span> <span class="n">n_2</span><span class="p">,</span> <span class="n">n</span>

<span class="k">def</span> <span class="nf">run</span><span class="p">():</span>
    <span class="n">sess</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">Session</span><span class="p">()</span>

    <span class="n">n_1</span><span class="p">,</span> <span class="n">n_2</span><span class="p">,</span> <span class="n">n</span> <span class="o">=</span> <span class="n">build_graph</span><span class="p">()</span>

    <span class="c"># First 2 terms are 0 and 1.</span>
    <span class="n">sess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="n">n_2</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
    <span class="n">sess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="n">n_1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">10</span><span class="p">):</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">sess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="s">'Term {} is {}'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">result</span><span class="p">))</span>
        <span class="n">sess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="n">n_2</span><span class="p">,</span> <span class="n">n_1</span><span class="p">))</span>
        <span class="n">sess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="n">n_1</span><span class="p">,</span> <span class="n">result</span><span class="p">))</span>

<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="n">run</span><span class="p">()</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">"__main__"</span><span class="p">:</span>
    <span class="n">main</span><span class="p">()</span></code></pre></figure>

<h1 id="variables-as-checkpoints">Variables as Checkpoints</h1>

<p>The real utility of <code class="highlighter-rouge">tf.Variable</code>s is TensorFlow’s ability to save <em>all</em> variables in a graph, effectively creating a “<em>checkpoint</em>” (or snapshot) of any particular run of the graph.</p>

<p>Typically, machine learning involves running numerous iterations of <em>training</em> to teach a machine. Each iteration can be saved, in terms of saving the value in every variable, into a checkpoint.</p>

<p>Such a checkpoint can be restored so training can continue from where we last left off, rather than starting from scratch.</p>

<p>In the following code, a checkpoint is saved at every <em>10n</em>th term, specifically at term 10 and term 20 in our case. Note how a simulated computer crash occurs at term 12, at which point the last checkpoint saved was at term 10. The code then successfully loads that checkpoint, and starts working from term 11.</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">import</span> <span class="nn">tensorflow</span> <span class="kn">as</span> <span class="nn">tf</span>
<span class="kn">import</span> <span class="nn">time</span>

<span class="k">def</span> <span class="nf">build_graph</span><span class="p">():</span>
    <span class="c"># Term n of a fibonacci sequence is the sum of last 2 terms.</span>

    <span class="n">n_1</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">get_variable</span><span class="p">(</span><span class="s">'n_1'</span><span class="p">,</span> <span class="p">[],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span> <span class="c"># (n-1)th term</span>
    <span class="n">n_2</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">get_variable</span><span class="p">(</span><span class="s">'n_2'</span><span class="p">,</span> <span class="p">[],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span> <span class="c"># (n-2)th term</span>

    <span class="n">n</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">n_1</span><span class="p">,</span> <span class="n">n_2</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">n_1</span><span class="p">,</span> <span class="n">n_2</span><span class="p">,</span> <span class="n">n</span>

<span class="k">def</span> <span class="nf">work</span><span class="p">(</span><span class="n">sess</span><span class="p">,</span> <span class="n">saver</span><span class="p">,</span> <span class="n">n_2</span><span class="p">,</span> <span class="n">n_1</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">step</span><span class="p">,</span> <span class="n">i</span><span class="p">):</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">sess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s">'Term {} is {}'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">result</span><span class="p">))</span>
    <span class="n">sess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="n">n_2</span><span class="p">,</span> <span class="n">n_1</span><span class="p">))</span>
    <span class="n">sess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="n">n_1</span><span class="p">,</span> <span class="n">result</span><span class="p">))</span>

    <span class="c"># Update step done.</span>
    <span class="n">sess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="n">step</span><span class="p">,</span> <span class="n">i</span><span class="p">))</span>

    <span class="c"># Save a checkpoint at every 10nth term</span>
    <span class="k">if</span> <span class="n">i</span> <span class="o">%</span> <span class="mi">10</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">saver</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">sess</span><span class="p">,</span> <span class="s">'checkpoints/fib.ckpt'</span><span class="p">,</span> <span class="n">global_step</span><span class="o">=</span><span class="n">i</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="s">'Checkpoint saved at step {}'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>

<span class="k">def</span> <span class="nf">run</span><span class="p">():</span>
    <span class="n">sess</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">Session</span><span class="p">()</span>

    <span class="n">n_1</span><span class="p">,</span> <span class="n">n_2</span><span class="p">,</span> <span class="n">n</span> <span class="o">=</span> <span class="n">build_graph</span><span class="p">()</span>
    <span class="n">step</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">get_variable</span><span class="p">(</span><span class="s">'step'</span><span class="p">,</span> <span class="p">[],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">tf</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span>
    <span class="n">sess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="n">step</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span> <span class="c"># We start with term 3.</span>

    <span class="c"># First 2 terms are 0 and 1.</span>
    <span class="n">sess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="n">n_2</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
    <span class="n">sess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">tf</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="n">n_1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>

    <span class="n">saver</span> <span class="o">=</span> <span class="n">tf</span><span class="o">.</span><span class="n">train</span><span class="o">.</span><span class="n">Saver</span><span class="p">()</span> <span class="c"># This object saves our progress to disk.</span>
    <span class="c"># Note: We have 3 variables: n_1, n_2 and step.</span>

    <span class="c"># Initial run, simulates a computer crash.</span>
    <span class="n">start</span> <span class="o">=</span> <span class="n">sess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">step</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span> <span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="mi">22</span><span class="p">):</span>
        <span class="n">work</span><span class="p">(</span><span class="n">sess</span><span class="p">,</span> <span class="n">saver</span><span class="p">,</span> <span class="n">n_2</span><span class="p">,</span> <span class="n">n_1</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">step</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
        <span class="c"># Simulate computer crash</span>
        <span class="k">if</span> <span class="n">i</span> <span class="o">&gt;</span> <span class="mi">12</span><span class="p">:</span>
            <span class="k">break</span>

    <span class="k">print</span><span class="p">(</span><span class="s">'Computer crashed. Attempting to resume work from last checkpoint...'</span><span class="p">)</span>

    <span class="c"># Restore latest checkpoint, if any.</span>
    <span class="n">saver</span><span class="o">.</span><span class="n">restore</span><span class="p">(</span><span class="n">sess</span><span class="p">,</span> <span class="n">tf</span><span class="o">.</span><span class="n">train</span><span class="o">.</span><span class="n">latest_checkpoint</span><span class="p">(</span><span class="s">'checkpoints'</span><span class="p">))</span>

    <span class="c"># Normal run. No computer crash.</span>
    <span class="n">start</span> <span class="o">=</span> <span class="n">sess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">step</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span> <span class="c"># Start with next step. Current step already done.</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span> <span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="mi">22</span><span class="p">):</span>
        <span class="n">work</span><span class="p">(</span><span class="n">sess</span><span class="p">,</span> <span class="n">saver</span><span class="p">,</span> <span class="n">n_2</span><span class="p">,</span> <span class="n">n_1</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">step</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="n">run</span><span class="p">()</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">"__main__"</span><span class="p">:</span>
    <span class="n">main</span><span class="p">()</span></code></pre></figure>

<h1 id="exercises">Exercises</h1>

<p>Clean up the above code such that:</p>
<ul>
  <li>There is an <code class="highlighter-rouge">init()</code> method that creates the <code class="highlighter-rouge">checkpoints</code> folder using initial values for variables. This method should be run only once.</li>
  <li>There is a <code class="highlighter-rouge">run()</code> method that can be executed to resume progress despite interruptions.</li>
</ul>

  </div>

</article>

      </div>
    </main>

    <footer class="site-footer">

  <div class="wrapper">

    <h2 class="footer-heading">50.021 Artificial Intelligence</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li>
            
              50.021 Artificial Intelligence
            
            </li>
            
            <li><a href="mailto:your-email@domain.com">your-email@domain.com</a></li>
            
        </ul>
      </div>

      <div class="footer-col footer-col-2">
        <ul class="social-media-list">
          
          <li>
            <a href="https://github.com/jekyll"><span class="icon icon--github"><svg viewBox="0 0 16 16" width="16px" height="16px"><path fill="#828282" d="M7.999,0.431c-4.285,0-7.76,3.474-7.76,7.761 c0,3.428,2.223,6.337,5.307,7.363c0.388,0.071,0.53-0.168,0.53-0.374c0-0.184-0.007-0.672-0.01-1.32 c-2.159,0.469-2.614-1.04-2.614-1.04c-0.353-0.896-0.862-1.135-0.862-1.135c-0.705-0.481,0.053-0.472,0.053-0.472 c0.779,0.055,1.189,0.8,1.189,0.8c0.692,1.186,1.816,0.843,2.258,0.645c0.071-0.502,0.271-0.843,0.493-1.037 C4.86,11.425,3.049,10.76,3.049,7.786c0-0.847,0.302-1.54,0.799-2.082C3.768,5.507,3.501,4.718,3.924,3.65 c0,0,0.652-0.209,2.134,0.796C6.677,4.273,7.34,4.187,8,4.184c0.659,0.003,1.323,0.089,1.943,0.261 c1.482-1.004,2.132-0.796,2.132-0.796c0.423,1.068,0.157,1.857,0.077,2.054c0.497,0.542,0.798,1.235,0.798,2.082 c0,2.981-1.814,3.637-3.543,3.829c0.279,0.24,0.527,0.713,0.527,1.437c0,1.037-0.01,1.874-0.01,2.129 c0,0.208,0.14,0.449,0.534,0.373c3.081-1.028,5.302-3.935,5.302-7.362C15.76,3.906,12.285,0.431,7.999,0.431z"/></svg>
</span><span class="username">jekyll</span></a>

          </li>
          

          
          <li>
            <a href="https://twitter.com/jekyllrb"><span class="icon icon--twitter"><svg viewBox="0 0 16 16" width="16px" height="16px"><path fill="#828282" d="M15.969,3.058c-0.586,0.26-1.217,0.436-1.878,0.515c0.675-0.405,1.194-1.045,1.438-1.809c-0.632,0.375-1.332,0.647-2.076,0.793c-0.596-0.636-1.446-1.033-2.387-1.033c-1.806,0-3.27,1.464-3.27,3.27 c0,0.256,0.029,0.506,0.085,0.745C5.163,5.404,2.753,4.102,1.14,2.124C0.859,2.607,0.698,3.168,0.698,3.767 c0,1.134,0.577,2.135,1.455,2.722C1.616,6.472,1.112,6.325,0.671,6.08c0,0.014,0,0.027,0,0.041c0,1.584,1.127,2.906,2.623,3.206 C3.02,9.402,2.731,9.442,2.433,9.442c-0.211,0-0.416-0.021-0.615-0.059c0.416,1.299,1.624,2.245,3.055,2.271 c-1.119,0.877-2.529,1.4-4.061,1.4c-0.264,0-0.524-0.015-0.78-0.046c1.447,0.928,3.166,1.469,5.013,1.469 c6.015,0,9.304-4.983,9.304-9.304c0-0.142-0.003-0.283-0.009-0.423C14.976,4.29,15.531,3.714,15.969,3.058z"/></svg>
</span><span class="username">jekyllrb</span></a>

          </li>
          
        </ul>
      </div>

      <div class="footer-col footer-col-3">
        <p>Artificial intelligence (AI) is a rich field spanning formal systems for representing and processing symbolic information, computational models of human cognition, and a range of techniques for learning, planning and reasoning under uncertainty.
</p>
      </div>
    </div>

  </div>

</footer>


  </body>

</html>
